<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <style>
        html, body {
            overscroll-behavior-x: none; /* відключає свайп двома пальцями на макосі */
        }
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        body {
            padding: 0;
            margin: 0;
            overflow: hidden;
            position: relative;
            min-height: 100vh;
        }
    </style>
    <link rel="stylesheet" href="assets/css/ui.css">
</head>
<body>

<div class="caesar3_ui">

    <nav>
        <ul>
            <li><a href="">File</a></li>
            <li><a href="">Options</a></li>
            <li><a href="">Help</a></li>
            <li>
                <a href="">Advisors</a>
            </li>
            <li>
                <a href="">Debug</a>
                <ul class="dropdown">
                    <li><a href="" id="showMissionDialog">Mission dialog</a></li>
                    <li><a href="" id="showVideoDialog">Video dialog</a></li>
                    <li><a href="" id="showNameDialog">Name dialog</a></li>
                </ul>
            </li>
        </ul>

        <div class="stats">
            <div class="stat">Dn 102</div>
            <div class="stat">Pop 31</div>
            <div class="stat stat-year">Feb 332 BC</div>
        </div>
    </nav>

    <main>
        <div class="map" id="mapContainer">

            <dialog id="missionDialog">
                <div class="dialog-content">
                    <h2>The New Governor</h2>

                    <div class="mb-2">A Village is Born</div>

                    <div class="scrollable-container mb-2">
                        <div class="scrollable">
                            <p>Objectives</p>

                            <button class="btn btn-block btn-default" disabled>Population of 150</button>
                            <button class="btn btn-block btn-default" disabled>Imediate goals build some houses.</button>
                        </div>
                    </div>
                    <div class="scrollable-container mb-2">
                        <div class="scrollable" style="height: 200px;">
                            <p>Let your gubernatorial training begin!</p>
                            <p>First, you must learn the basics of constructing Roman settlements.</p>
                            <p>Build areas of housing, and you'll soon see people move in to your city.</p>

                            <img class="img-center" src="assets/images/tutorial/img1.png" />

                            <p>Paths</p>
                            <p>You can click and drag the mouse to build lengths of path at once.</p>

                            <img class="img-center" src="assets/images/tutorial/img2.png" />
                            <p>You can click and drag the mouse to build lengths of path at once.</p>
                            <p>Plan paths carefully, with as few intersections as possible, to ensure people will walk where you want them to. At every intersection, walkers must choose which way to go. Each intersection lessens your control over their actual routes.</p>

                            <img class="img-center" src="assets/images/tutorial/img3.png" />
                        </div>
                    </div>

                    <div class="d-flex">
                        <div class="spacer"></div>
                        <button data-action="close" class="btn btn-block btn-round-next">To the city</button>
                    </div>
                </div>
                <div class="dialog-corners"></div>
            </dialog>

            <dialog id="nameDialog">
                <div class="dialog-content">
                    <h2>Please enter your name</h2>

                    <div class="scrollable-container noscroll mb-2">
                        <div>
                            <input class="form-control" value="The new governor" type="text" />
                        </div>
                    </div>
                    <div class="d-flex">
                        <div class="spacer"></div>
                        <button data-action="close" class="btn btn-block btn-round-next">Continue</button>
                    </div>
                </div>
                <div class="dialog-corners"></div>
            </dialog>

            <dialog id="videoDialog" class="video-dialog">
                <video id="video" src="assets/videos/urgent_message1.mp4"></video>

                <div class="scrollable-container noscroll">
                    <div>
                        <p>Jul 345 BC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To Player</p>
                        <p>Rome has need of the following goods. Please arrange for their swift dispatch.</p>

                    </div>
                </div>

                <div class="dialog-content">
                    <div class="d-flex">
                        <a href="#" class="btn btn-block btn-sm-question"></a>
                        <div class="spacer text-center">
                            Emperor requests goods
                        </div>
                        <a href="#" data-action="close" class="btn btn-block btn-sm-next"></a>
                    </div>
                </div>
                <div class="dialog-corners"></div>
            </dialog>

            <div class="d-overlays-menu" id="menuOverlays"></div>

            <div class="d-buildings-menu" id="menuBuildings">
                <button class="btn btn-block btn-default">
                    Well
                </button>
                <button class="btn btn-block btn-default">
                    Farm
                    <span>40Dn</span>
                </button>
                <button class="btn btn-block btn-default">
                    Water
                    <span>40Dn</span>
                </button>
            </div>

            <canvas id="main"></canvas>
        </div>

        <aside>
            <div class="aside-buttons">
                <div class="top-buttons">
                    <button class="btn btn-overlay" id="btnOverlay">Overlay</button>
                    <button disabled class="btn btn-toggle-sidebar"></button>
                </div>

                <div class="minimap">
                    <canvas id="minimap"></canvas>
                </div>

                <div class="btn-row">
                    <button class="btn btn-senat"></button>
                    <button class="btn btn-map"></button>
                </div>

                <div class="btn-row">
                    <button class="btn btn-doc"></button>
                    <button class="btn btn-north"></button>
                    <button class="btn btn-rotate-cw"></button>
                    <button class="btn btn-rotate-ccw"></button>
                </div>

                <div class="img-placeholder" id="imgPlaceholder"></div>

                <div class="build-buttons">
                    <button data-tool="house" class="btn icon-house"></button>
                    <button data-tool="shovel" class="btn icon-shovel"></button>
                    <button data-tool="road" class="btn icon-road"></button>
                    <button data-building="house" class="btn icon-water"></button>
                    <button data-building="house" class="btn icon-medical"></button>
                    <button data-building="house" disabled class="btn icon-gods"></button>
                    <button data-building="house" class="btn icon-edu"></button>
                    <button data-building="house" class="btn icon-ent"></button>
                    <button data-building="house" class="btn icon-gov"></button>
                    <button data-building="house" class="btn icon-eng"></button>
                    <button data-building="house" class="btn icon-prot"></button>
                    <button data-building="house" class="btn icon-mar"></button>
                    <button data-building="house" disabled class="btn icon-cancel"></button>
                    <button data-building="house" class="btn icon-messages">0</button>
                    <button data-building="house" disabled class="btn icon-bell"></button>
                </div>
            </div>
            <div class="aside-placeholder"></div>
        </aside>

        <dialog id="terrainInfoDialog">
            <div class="dialog-content">
                <div class="scrollable-container noscroll mb-2">
                    <div>
                        <div>
                            X: <span data-bind="mapX"></span>, Y: <span data-bind="mapY"></span>,
                            Tile: <span data-bind="tile"></span>,
                            Edge: <span data-bind="edge"></span>,
                            Minimap: <span data-bind="minimapInfo"></span>,
                            Elevation: <span data-bind="elevation"></span>,
                            Random: <span data-bind="random"></span>,
                            Tile size: <span data-bind="tileSize"></span>
                        </div>
                        <pre data-bind="terrainInfo"></pre>
                    </div>
                </div>
            </div>
            <div class="dialog-content">
                <div class="d-flex">
                    <a href="#" class="btn btn-block btn-sm-question"></a>
                    <div class="spacer"></div>
                    <a href="#" data-action="close" class="btn btn-block btn-sm-next"></a>
                </div>
            </div>
            <div class="dialog-corners"></div>
        </dialog>
    </main>

</div>

<script type="module">
    import DependencyInjection from '/src/DependencyInjection.mjs';
    import SceneManager from '/src/SceneManager.mjs';
    import ResourceManager from '/src/ResourceManager.mjs';
    import DrawingContext from '/src/DrawingContext.mjs';
    import InputManager from '/src/InputManager.mjs';
    import MapReader from './src/MapReader.mjs';
    import GameUI from './src/GameUI.mjs';
    import WalkersMap from './src/WalkersMap.mjs';
    import GameScene from './src/Scenes/GameScene.mjs';
    import ImmigrantWalker from './src/Walkers/ImmigrantWalker.mjs';

    async function bootstrap() {
        const di = DependencyInjection.createRoot({
            ResourceManager,
            DrawingContext,
            InputManager,
            GameUI
        });
        const mainCanvas = document.getElementById('main');
        di.set('canvas', mainCanvas);

        const sceneManager = di.get(SceneManager);
        const drawingContext = di.get(DrawingContext);

        const scene = await sceneManager.loadScene(GameScene);

        drawingContext.bindToElement(document.getElementById('mapContainer'));
        drawingContext.loop();

        scene.map = new WalkersMap(di, {});
        scene.map.visibleAreaSize = [drawingContext.width, drawingContext.height];
        scene.map.initDebugMap();
        mainCanvas.addEventListener('dragover', function(e) {
            e.stopPropagation();
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
        });
        mainCanvas.addEventListener('drop', function(e) {
            e.stopPropagation();
            e.preventDefault();
            const [file] = e.dataTransfer.files;

            const reader = new FileReader();

            reader.onload = function({ target }) {
                const mapData = new MapReader(target.result);
                scene.map = new WalkersMap(di, mapData);
                scene.map.visibleAreaSize = [drawingContext.width, drawingContext.height];
                scene.map.initMap();
            }
            reader.readAsBinaryString(file);
        });
    }
    bootstrap();
</script>
</body>
</html>
